<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Burn Scar Detection</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <style>
        :root {
            font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
            background: #0f172a;
            color: #e5e7eb;
        }

        body {
            margin: 0;
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            background: radial-gradient(circle at top, #1d283a 0, #020617 55%);
        }

        .app-shell {
            width: 100%;
            max-width: 1100px;
            padding: 2rem 1.5rem;
        }

        .card {
            background: rgba(15, 23, 42, 0.9);
            border-radius: 1.25rem;
            padding: 1.75rem 1.5rem 1.75rem;
            box-shadow:
                0 25px 60px rgba(15, 23, 42, 0.85),
                0 0 0 1px rgba(148, 163, 184, 0.1);
            backdrop-filter: blur(14px);
        }

        .header-row {
            display: flex;
            justify-content: space-between;
            gap: 1rem;
            margin-bottom: 1.75rem;
            align-items: center;
        }

        .title-block h1 {
            font-size: 1.5rem;
            font-weight: 650;
            letter-spacing: 0.02em;
            margin: 0 0 0.35rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .title-pill {
            font-size: 0.7rem;
            text-transform: uppercase;
            letter-spacing: 0.16em;
            padding: 0.1rem 0.45rem;
            border-radius: 999px;
            border: 1px solid rgba(59, 130, 246, 0.5);
            background: radial-gradient(circle at top left, rgba(59, 130, 246, 0.3), transparent);
            color: #bfdbfe;
        }

        .title-block p {
            margin: 0;
            font-size: 0.85rem;
            color: #9ca3af;
        }

        .api-pill {
            font-size: 0.75rem;
            padding: 0.4rem 0.7rem;
            border-radius: 999px;
            border: 1px solid rgba(96, 165, 250, 0.4);
            color: #dbeafe;
            background: rgba(15, 23, 42, 0.9);
        }

        .content-grid {
            display: grid;
            grid-template-columns: minmax(0, 1.1fr) minmax(0, 1.2fr);
            gap: 1.5rem;
        }

        @media (max-width: 900px) {
            .content-grid {
                grid-template-columns: minmax(0, 1fr);
            }
        }

        .panel {
            padding: 1.25rem 1.35rem;
            background: rgba(15, 23, 42, 0.85);
            border-radius: 1rem;
            border: 1px solid rgba(148, 163, 184, 0.22);
        }

        .panel h2 {
            margin: 0 0 1rem;
            font-size: 0.95rem;
            text-transform: uppercase;
            letter-spacing: 0.16em;
            color: #9ca3af;
        }

        .field-grid {
            display: grid;
            grid-template-columns: repeat(2, minmax(0, 1fr));
            gap: 0.9rem 0.8rem;
            margin-bottom: 1rem;
        }

        .field {
            display: flex;
            flex-direction: column;
            gap: 0.25rem;
        }

        .field label {
            font-size: 0.8rem;
            color: #9ca3af;
        }

        .field input {
            padding: 0.55rem 0.6rem;
            border-radius: 0.6rem;
            border: 1px solid rgba(148, 163, 184, 0.45);
            background: rgba(15, 23, 42, 0.85);
            color: #e5e7eb;
            font-size: 0.85rem;
        }

        .field input:focus {
            outline: none;
            border-color: rgba(96, 165, 250, 0.9);
            box-shadow: 0 0 0 1px rgba(59, 130, 246, 0.7);
        }

        .helper-text {
            font-size: 0.75rem;
            color: #6b7280;
            margin-bottom: 1rem;
        }

        .btn-row {
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        button.primary {
            appearance: none;
            border: none;
            border-radius: 999px;
            padding: 0.6rem 1.4rem;
            font-size: 0.9rem;
            font-weight: 550;
            letter-spacing: 0.04em;
            text-transform: uppercase;
            cursor: pointer;
            background: radial-gradient(circle at top left, #3b82f6, #1d4ed8);
            color: white;
            box-shadow:
                0 12px 25px rgba(37, 99, 235, 0.55),
                0 0 0 1px rgba(191, 219, 254, 0.5);
            transition: transform 0.08s ease, box-shadow 0.08s ease, filter 0.08s ease;
        }

        button.primary:hover:not(:disabled) {
            transform: translateY(-1px);
            filter: brightness(1.08);
            box-shadow:
                0 16px 35px rgba(37, 99, 235, 0.75),
                0 0 0 1px rgba(219, 234, 254, 0.65);
        }

        button.primary:disabled {
            opacity: 0.55;
            cursor: default;
            box-shadow: none;
        }

        .status-text {
            font-size: 0.8rem;
            color: #9ca3af;
        }

        .status-text.error {
            color: #fecaca;
        }

        .results-wrapper {
            display: grid;
            grid-template-columns: minmax(0, 1fr);
            gap: 1rem;
        }

        .mask-container {
            border-radius: 0.9rem;
            border: 1px solid rgba(55, 65, 81, 0.9);
            background: radial-gradient(circle at top, rgba(17, 24, 39, 0.95), rgba(15, 23, 42, 0.98));
            padding: 0.75rem;
        }

        .mask-container h3 {
            margin: 0 0 0.5rem;
            font-size: 0.85rem;
            color: #9ca3af;
            text-transform: uppercase;
            letter-spacing: 0.14em;
        }

        .mask-inner {
            border-radius: 0.7rem;
            overflow: hidden;
            background: black;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 260px;
        }

        .mask-inner img:
            max-width: 100%;
            display: block;
        }

        .note-text {
            font-size: 0.72rem;
            color: #6b7280;
            margin-top: 0.2rem;
        }
    </style>
</head>
<body>

<div class="app-shell">
    <div class="card">

        <div class="header-row">
            <div class="title-block">
                <h1>
                    Burn Scar Detection
                    <span class="title-pill">Sentinel-2 · U-Net</span>
                </h1>
                <p>Enter bounding box and date range. The model will download Sentinel-2 imagery,
                    run inference, and display detailed wildfire burn analysis.</p>
            </div>
            <div class="api-pill">API: /predict_with_bbox</div>
        </div>

        <div class="content-grid">

            <!-- LEFT PANEL -->
            <div class="panel">
                <h2>Query parameters</h2>

                <div class="field-grid">
                    <div class="field">
                        <label for="minLon">Min Longitude</label>
                        <input id="minLon" type="number" step="0.0001">
                    </div>
                    <div class="field">
                        <label for="minLat">Min Latitude</label>
                        <input id="minLat" type="number" step="0.0001">
                    </div>
                    <div class="field">
                        <label for="maxLon">Max Longitude</label>
                        <input id="maxLon" type="number" step="0.0001">
                    </div>
                    <div class="field">
                        <label for="maxLat">Max Latitude</label>
                        <input id="maxLat" type="number" step="0.0001">
                    </div>
                    <div class="field">
                        <label for="dateFrom">Date from</label>
                        <input id="dateFrom" type="date">
                    </div>
                    <div class="field">
                        <label for="dateTo">Date to</label>
                        <input id="dateTo" type="date">
                    </div>
                </div>

                <div class="btn-row">
                    <button id="runBtn" class="primary">Run Detection</button>
                    <div id="status" class="status-text">Idle.</div>
                </div>
            </div>

            <!-- RIGHT PANEL -->
            <div class="panel">
                <h2>Results</h2>

                <div id="results" class="results-wrapper" style="display:none;">

    <div class="mask-container">
        <h3>Satellite Imagery (RGB)</h3>
        <div class="mask-inner">
            <img id="rgbImg">
        </div>
    </div>

    <div class="mask-container">
        <h3>Burn Scar Overlay</h3>
        <div class="mask-inner">
            <img id="overlayImg">
        </div>
    </div>

    <div class="mask-container">
        <h3>Burn Scar Mask</h3>
        <div class="mask-inner">
            <img id="maskImg">
        </div>
    </div>

    <div class="mask-container">
        <h3>Model Confidence</h3>
        <div class="mask-inner">
            <img id="confImg">
        </div>
    </div>

</div>

            </div>

        </div>
    </div>
</div>

<script>
    const API_BASE = "http://127.0.0.1:8000";

    const runBtn = document.getElementById("runBtn");
    const statusEl = document.getElementById("status");
    const resultsEl = document.getElementById("results");
    const visualImgEl = document.getElementById("visualImg");

    async function runDetection() {

        const minLon = parseFloat(document.getElementById("minLon").value);
        const minLat = parseFloat(document.getElementById("minLat").value);
        const maxLon = parseFloat(document.getElementById("maxLon").value);
        const maxLat = parseFloat(document.getElementById("maxLat").value);
        const dateFrom = document.getElementById("dateFrom").value;
        const dateTo = document.getElementById("dateTo").value;

        if (!dateFrom || !dateTo) {
            statusEl.textContent = "Please select a date range.";
            return;
        }

        statusEl.textContent = "Running inference…";
        runBtn.disabled = true;
        resultsEl.style.display = "none";

        try {
            const payload = {
                min_lon: minLon,
                min_lat: minLat,
                max_lon: maxLon,
                max_lat: maxLat,
                date_from: dateFrom,
                date_to: dateTo
            };

            const resp = await fetch(`${API_BASE}/predict_with_bbox`, {
                method: "POST",
                headers: {"Content-Type": "application/json"},
                body: JSON.stringify(payload)
            });

            if (!resp.ok) {
                const err = await resp.json().catch(() => ({}));
                throw new Error(err.detail || `Error ${resp.status}`);
            }

            const data = await resp.json();

            if (data.rgb_base64) {
    document.getElementById("rgbImg").src =
        "data:image/png;base64," + data.rgb_base64;
}
if (data.overlay_base64) {
    document.getElementById("overlayImg").src =
        "data:image/png;base64," + data.overlay_base64;
}
if (data.mask_base64) {
    document.getElementById("maskImg").src =
        "data:image/png;base64," + data.mask_base64;
}
if (data.confidence_base64) {
    document.getElementById("confImg").src =
        "data:image/png;base64," + data.confidence_base64;
}


            statusEl.textContent = "Inference complete.";
            resultsEl.style.display = "grid";

        } catch (err) {
            statusEl.textContent = "Error: " + err.message;
        } finally {
            runBtn.disabled = false;
        }
    }

    runBtn.addEventListener("click", runDetection);
</script>

</body>
</html>
